<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register Your Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="bg-yellow-50">
    <!-- Shop Owner Registration -->
    <div class="container mx-auto p-6">
        <div class="bg-white shadow-lg rounded-lg p-8">
            <h2 class="text-2xl font-bold text-black mb-6 text-center">
                <i class="fas fa-store mr-3"></i>Register Your Shop
            </h2>
            
            <form id="shop-registration-form" class="space-y-4">
                <div>
                    <label class="block text-gray-700 mb-2">Shop Name</label>
                    <input 
                        type="text" 
                        id="shop-name" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md"
                        placeholder="Enter shop name"
                        required
                    >
                </div>
                
                <div>
                    <label class="block text-gray-700 mb-2">Shop Type</label>
                    <select 
                        id="shop-type" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md"
                        required
                    >
                        <option value="">Select Shop Type</option>
                        <option value="Retail">Retail</option>
                        <option value="Restaurant">Restaurant</option>
                        <option value="Grocery">Grocery</option>
                        <option value="Electronics">Electronics</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-gray-700 mb-2">Shop Location</label>
                    <input 
                        type="text" 
                        id="shop-location" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md"
                        placeholder="Enter shop address"
                        required
                    >
                </div>
                
                <button 
                    type="submit" 
                    class="w-full bg-black text-yellow-400 py-2 rounded-md hover:bg-yellow-800 transition duration-300"
                >
                    Register Shop
                </button>
            </form>

            <div class="mt-6">
                <h3 class="text-xl font-bold mb-4">Registered Shops</h3>
                <div id="shop-list" class="space-y-2">
                    <p class="text-gray-500">No shops registered yet</p>
                </div>
            </div>
        </div>
    </div>

    <script>
  async function registerShop(event) {
    event.preventDefault();
    const shopName = document.getElementById('shop-name').value;
    const shopType = document.getElementById('shop-type').value;
    const shopLocation = document.getElementById('shop-location').value;

    console.log('Form submitted, collecting shop details...');
    console.log(`Shop Name: ${shopName}, Shop Type: ${shopType}, Shop Location: ${shopLocation}`);

    // Fetch the owner's ID from the session
    const ownerId = await getOwnerIdFromSession();

    if (!shopName || !shopType || !shopLocation || !ownerId) {
        console.log('Missing required fields or ownerId');
        alert('Please fill in all fields');
        return;
    }

    const newShop = {
        name: shopName,
        type: shopType,
        location: shopLocation,
        ownerId: ownerId,  // Send the owner's ID along
    };

    console.log('Creating new shop:', newShop);

    try {
        const response = await fetch('http://localhost:5000/shopowner/register-shop', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(newShop),
        });

        const result = await response.json();

        if (response.status === 201) {
            console.log('Shop registered successfully:', result.shop);
            alert('Shop registered successfully!');
            updateShopList(result.shop);  // Optionally update the shop list

            // Redirect to the home page after successful registration
            console.log('Redirecting to home page...');
            window.location.href = '/';  // Redirects to the home page
        } else {
            console.log('Failed to register shop:', result.message);
            alert(result.message);
        }
    } catch (error) {
        console.log('Error during shop registration:', error);
        alert('Error registering shop');
    }
}

async function getOwnerIdFromSession() {
    console.log('Fetching owner ID from session...');
    try {
        const response = await fetch('http://localhost:5000/shopowner/get-owner-id');
        const data = await response.json();
        
        if (data.ownerId) {
            console.log('Owner ID retrieved from session:', data.ownerId);
            return data.ownerId;
        } else {
            console.log('No owner ID found in session');
            return null;
        }
    } catch (error) {
        console.log('Error fetching owner ID from session:', error);
        return null;
    }
}

function updateShopList(newShop) {
    console.log('Updating shop list with new shop:', newShop);
    const shopListContainer = document.getElementById('shop-list');
    shopListContainer.innerHTML += `
        <div class="bg-yellow-50 p-4 rounded-md mb-2 flex justify-between items-center">
            <div>
                <h3 class="font-bold">${newShop.name}</h3>
                <p class="text-sm text-gray-600">${newShop.type} - ${newShop.location}</p>
            </div>
        </div>
    `;
}


    </script>
</body>
</html>
